#include <SDL2/SDL.h>
#include <SDL2/SDL_opengl.h>
#include <stddef.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <time.h>

const GLfloat squarePoints[] = {
	1.0, 1.0,
	-1.0, 1.0,
	-1.0, -1.0,
	-1.0, -1.0,
	1.0, -1.0,
	1.0, 1.0
};

const char *starVertexShaderSource = "\
#version 150\n\
uniform float time;\n\
uniform vec2 scale;\n\
uniform float starSpeed;\n\
in vec2 position;\n\
in vec2 starCenter;\n\
in float starProximity;\n\
void main()\n\
{\n\
	float effectiveTime = time * starSpeed * 2.0 * starProximity;\n\
	vec2 calculatedCenter = vec2(mod(1.0 + (starCenter.x + effectiveTime), 2.0) - 1.0, starCenter.y);\n\
	vec2 size = max(4.0 * starProximity, 0.75) * scale;\n\
	vec2 clippingCenter = calculatedCenter * (1.0 + size) - size / 2.0;\n\
	gl_Position = vec4(position * size + clippingCenter, 1.0 - starProximity, 1.0);\n\
}\n\
";

const char *starFragmentShaderSource = "\
#version 150\n\
out vec4 fragColor;\n\
void main()\n\
{\n\
	fragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\
}\n\
";

const size_t FLOATS_PER_STAR_VERTEX = 5;
const size_t FLOATS_PER_STAR = FLOATS_PER_STAR_VERTEX * ((sizeof(squarePoints) / sizeof(squarePoints[0])) / 2);

const char *witchVertexShaderSource = "\
#version 150\n\
uniform float time;\n\
uniform vec2 scale;\n\
uniform vec2 witchCenter;\n\
uniform vec2 witchSize;\n\
uniform vec2 witchField;\n\
in vec2 position;\n\
out vec2 textureCoord;\n\
void main()\n\
{\n\
	float effectiveTime = time;\n\
	vec2 calculatedCenter = witchCenter - vec2(cos(time), sin(time)) * witchField;\n\
	gl_Position = vec4(position * witchSize * scale + calculatedCenter * scale, 1.0, 1.0);\n\
	textureCoord = vec2((1.0 + position.x) / 2.0, (1.0 - position.y) / 2.0);\n\
}\n\
";

const char *witchFragmentShaderSource = "\
#version 150\n\
uniform sampler2D witchTexture;\n\
in vec2 textureCoord;\n\
out vec4 fragColor;\n\
void main()\n\
{\n\
    fragColor = texture(witchTexture, textureCoord).rrrr;\n\
}\n\
";

const char witchPixels[] = {
	0xFE, 0x1F, 0xFF, 0xE0, 0x7F, 0xFE, 0x00, 0x7F,
	0xE0, 0x01, 0xFF, 0x01, 0xF7, 0xF0, 0x1F, 0xFE,
	0x00, 0x1F, 0xFE, 0x0F, 0x7F, 0xE4, 0x7F, 0xFF,
	0x83, 0xFF, 0xFC, 0x1F, 0xFF, 0xF9, 0xFF, 0xFF,
	0xC7, 0xFF, 0xFF, 0x1F, 0xFF, 0xF0, 0xFF, 0x1F,
	0x87, 0xF0, 0x00, 0x00, 0x07, 0xE0, 0xFC, 0x3F,
	0xC3, 0xE1, 0xFF, 0x1F, 0x80
};
const size_t witchWidth = 21;
const size_t witchHeight = 20;
const size_t witchWidthAligned = 24;

const char *textVertexShaderSource = "\
#version 150\n\
uniform vec2 scale;\n\
uniform vec2 center;\n\
uniform vec2 size;\n\
in vec2 position;\n\
out vec2 textureCoord;\n\
void main()\n\
{\n\
	gl_Position = vec4(position * size * scale + center * scale, 1.0, 1.0);\n\
	textureCoord = vec2((1.0 + position.x) / 2.0, (1.0 - position.y) / 2.0);\n\
}\n\
";

const char *textFragmentShaderSource = "\
#version 150\n\
uniform sampler2D textTexture;\n\
in vec2 textureCoord;\n\
out vec4 fragColor;\n\
void main()\n\
{\n\
    fragColor = texture(textTexture, textureCoord).rrrr;\n\
}\n\
";

#define textWidth 295
#define textHeight 39
static unsigned char textBits[] = {
	0x7f, 0x00, 0x00, 0xc0, 0xc1, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x7c, 0x00, 0x00, 0xe0, 0x01, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x78, 0x00, 0x00, 0xe0, 0x01, 0x1e, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0xe0, 0x01, 0x1e, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0xc0, 0x00, 0x1e, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00, 0x1e,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00, 0x00,
	0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0xf8, 0x01, 0x00,
	0x00, 0x0e, 0x00, 0x00, 0xf0, 0x0f, 0xc0, 0x87, 0x07, 0x00, 0x00, 0x00,
	0x1f, 0x7e, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x80, 0x1f, 0xe0, 0x07,
	0x00, 0x80, 0x0f, 0x1f, 0xe0, 0x03, 0x00, 0xf8, 0x01, 0x78, 0xfe, 0x07,
	0xfc, 0x01, 0x0e, 0xfc, 0x07, 0x1c, 0x1c, 0xe0, 0xe7, 0xef, 0x0f, 0x00,
	0xc0, 0x9f, 0xf3, 0x01, 0xc0, 0xe1, 0x81, 0xff, 0xe1, 0x3f, 0x1f, 0xc0,
	0x07, 0x00, 0xe0, 0xcf, 0x7f, 0xf8, 0x0f, 0x00, 0x0e, 0x07, 0x78, 0x03,
	0x0f, 0xf8, 0x01, 0x0e, 0xf0, 0x01, 0x0e, 0x38, 0x80, 0x37, 0xcf, 0x0f,
	0x00, 0x00, 0xde, 0xc0, 0x03, 0x60, 0x80, 0x03, 0x7e, 0x00, 0x0f, 0x1e,
	0x80, 0x07, 0x00, 0x00, 0x6f, 0xf0, 0x0c, 0x1e, 0x00, 0x07, 0x0e, 0xf8,
	0x01, 0x0e, 0xe0, 0x01, 0x0e, 0x60, 0x00, 0x07, 0x78, 0x80, 0x17, 0x0f,
	0x0f, 0x00, 0x00, 0x5e, 0x80, 0x03, 0x70, 0x00, 0x07, 0x3c, 0x00, 0x07,
	0x1c, 0x80, 0x07, 0x00, 0x00, 0x3f, 0xf0, 0x06, 0x1c, 0x80, 0x03, 0x1c,
	0xf8, 0x00, 0x1e, 0xe0, 0x01, 0x0e, 0x30, 0x80, 0x07, 0x78, 0x80, 0x0f,
	0x00, 0x0f, 0x00, 0x00, 0x3e, 0x80, 0x07, 0x38, 0x00, 0x0f, 0x38, 0x00,
	0x03, 0x1c, 0x80, 0x07, 0x00, 0x00, 0x1f, 0xe0, 0x02, 0x1c, 0xc0, 0x01,
	0x3c, 0xf8, 0x00, 0x1e, 0xc0, 0x01, 0x0e, 0x10, 0x80, 0x07, 0x78, 0x80,
	0x0f, 0x00, 0x0e, 0x00, 0x00, 0x3e, 0x80, 0x07, 0x3c, 0x00, 0x0e, 0x78,
	0x00, 0x03, 0x1c, 0x80, 0x07, 0x00, 0x00, 0x0f, 0xe0, 0x03, 0x3c, 0xc0,
	0x01, 0x38, 0x78, 0x00, 0x1e, 0xc0, 0x01, 0x0e, 0x08, 0x80, 0x07, 0x78,
	0x80, 0x07, 0x00, 0x0e, 0x00, 0x00, 0x1e, 0x80, 0x07, 0x1c, 0x00, 0x1e,
	0x78, 0x00, 0x01, 0x1c, 0x80, 0x07, 0x00, 0x00, 0x0f, 0xe0, 0x01, 0x3c,
	0xe0, 0x01, 0x38, 0x78, 0x00, 0x1e, 0xc0, 0x01, 0x0e, 0x0c, 0x00, 0x00,
	0x78, 0x80, 0x07, 0x00, 0x0e, 0x00, 0x00, 0x1e, 0x80, 0x07, 0x1c, 0x00,
	0x1e, 0x70, 0x80, 0x01, 0x1c, 0x80, 0x07, 0x00, 0x00, 0x0f, 0xe0, 0x01,
	0x3c, 0xe0, 0x00, 0x38, 0x78, 0x00, 0x1e, 0xc0, 0x01, 0x0e, 0x06, 0x00,
	0x00, 0x78, 0x80, 0x07, 0x00, 0x0e, 0x00, 0x00, 0x1e, 0x80, 0x07, 0x1e,
	0x00, 0x1e, 0xf0, 0x80, 0x00, 0x1c, 0x80, 0x07, 0x00, 0x00, 0x0f, 0xe0,
	0x01, 0x3c, 0xe0, 0x00, 0x78, 0x78, 0x00, 0x1e, 0xc0, 0x01, 0x0e, 0x03,
	0x00, 0x00, 0x78, 0x80, 0x07, 0x00, 0x0e, 0x00, 0x00, 0x1e, 0x80, 0x07,
	0x1e, 0x00, 0x1e, 0xf0, 0x80, 0x00, 0x1c, 0x80, 0x07, 0x00, 0x00, 0x0f,
	0xe0, 0x01, 0x3c, 0xf0, 0x00, 0x78, 0x78, 0x00, 0x1e, 0xc0, 0x01, 0x8e,
	0x07, 0x00, 0xc0, 0x7f, 0x80, 0x07, 0x00, 0x0e, 0x00, 0x00, 0x1e, 0x80,
	0x07, 0x1e, 0x00, 0x3c, 0xe0, 0xc0, 0x00, 0x1c, 0x80, 0x07, 0x00, 0x00,
	0x0f, 0xe0, 0x01, 0x3c, 0xf0, 0xff, 0x7f, 0x78, 0x00, 0x1e, 0xc0, 0x01,
	0xce, 0x07, 0x00, 0xfc, 0x7f, 0x80, 0x07, 0x00, 0x0e, 0x00, 0x00, 0x1e,
	0x80, 0x07, 0x1e, 0x00, 0x3c, 0xe0, 0x41, 0x00, 0x1c, 0x80, 0x07, 0x00,
	0x00, 0x0f, 0xe0, 0x01, 0x3c, 0xf0, 0x00, 0x00, 0x78, 0x00, 0x1e, 0xc0,
	0x01, 0x6e, 0x0f, 0x00, 0x7f, 0x78, 0x80, 0x07, 0x00, 0x0e, 0x00, 0x00,
	0x1e, 0x80, 0x07, 0x1e, 0x00, 0x3c, 0xc0, 0x41, 0x00, 0x1c, 0x80, 0x07,
	0x00, 0x00, 0x0f, 0xe0, 0x01, 0x3c, 0xf0, 0x00, 0x00, 0x78, 0x00, 0x1e,
	0xc0, 0x01, 0x2e, 0x1e, 0x80, 0x0f, 0x78, 0x80, 0x07, 0x00, 0x0e, 0x00,
	0x00, 0x1e, 0x80, 0x07, 0x1e, 0x00, 0x1c, 0xc0, 0x61, 0x00, 0x1c, 0x80,
	0x07, 0x00, 0x00, 0x0f, 0xe0, 0x01, 0x3c, 0xf0, 0x00, 0x00, 0x78, 0x00,
	0x1e, 0xc0, 0x01, 0x1e, 0x1e, 0x80, 0x07, 0x78, 0x80, 0x07, 0x00, 0x0e,
	0x00, 0x00, 0x1e, 0x80, 0x07, 0x1e, 0x00, 0x1c, 0xc0, 0x23, 0x00, 0x1c,
	0x80, 0x07, 0x00, 0x00, 0x0f, 0xe0, 0x01, 0x3c, 0xf0, 0x00, 0x00, 0x78,
	0x00, 0x1e, 0xc0, 0x01, 0x0e, 0x3c, 0xc0, 0x03, 0x78, 0x80, 0x07, 0x00,
	0x0e, 0x00, 0x00, 0x1e, 0x80, 0x07, 0x1e, 0x00, 0x1e, 0x80, 0x33, 0x00,
	0x1c, 0x80, 0x07, 0x00, 0x00, 0x0f, 0xe0, 0x01, 0x3c, 0xf0, 0x00, 0x00,
	0x78, 0x00, 0x1e, 0xc0, 0x01, 0x0e, 0x78, 0xc0, 0x03, 0x78, 0x80, 0x07,
	0x00, 0x0e, 0x00, 0x00, 0x1e, 0x80, 0x07, 0x1c, 0x00, 0x1e, 0x80, 0x17,
	0x00, 0x1c, 0x80, 0x07, 0x00, 0x00, 0x0f, 0xe0, 0x01, 0x3c, 0xe0, 0x01,
	0x00, 0x78, 0x00, 0x1e, 0xc0, 0x01, 0x0e, 0x78, 0xc0, 0x03, 0x78, 0x80,
	0x07, 0x00, 0x0e, 0x00, 0x00, 0x1e, 0x80, 0x07, 0x3c, 0x00, 0x1e, 0x00,
	0x17, 0x00, 0x1c, 0x80, 0x07, 0x00, 0x00, 0x0f, 0xe0, 0x01, 0x3c, 0xe0,
	0x01, 0x00, 0x78, 0x00, 0x1e, 0xc0, 0x01, 0x1e, 0xf0, 0xc0, 0x03, 0x78,
	0x80, 0x07, 0x00, 0x0e, 0xe0, 0x00, 0x1e, 0x80, 0x07, 0x3c, 0x00, 0x0e,
	0x00, 0x1f, 0x00, 0x1c, 0xc0, 0x07, 0x70, 0x00, 0x0f, 0xe0, 0x01, 0x3c,
	0xe0, 0x01, 0x40, 0x78, 0x00, 0x1e, 0xc0, 0x01, 0x1e, 0xf0, 0xc0, 0x03,
	0x7c, 0x80, 0x07, 0x00, 0x0e, 0xf0, 0x01, 0x1e, 0x80, 0x07, 0x38, 0x00,
	0x0f, 0x00, 0x0f, 0x00, 0x3c, 0xc0, 0x07, 0xf8, 0x00, 0x0f, 0xe0, 0x01,
	0x3c, 0xc0, 0x03, 0x20, 0x78, 0x00, 0x1e, 0xe0, 0x01, 0x1e, 0xe0, 0xc1,
	0x03, 0x7c, 0x80, 0x07, 0x00, 0x0f, 0xf0, 0x03, 0x1e, 0x80, 0x07, 0x78,
	0x00, 0x07, 0x00, 0x0e, 0x00, 0x3c, 0xe0, 0x07, 0xf8, 0x01, 0x0f, 0xe0,
	0x01, 0x3c, 0x80, 0x07, 0x30, 0x7c, 0x00, 0x3e, 0xe0, 0x03, 0x1f, 0xe0,
	0x83, 0x07, 0x72, 0x80, 0x0f, 0x00, 0x1f, 0xf0, 0x03, 0x3e, 0x80, 0x0f,
	0xf0, 0x80, 0x03, 0x00, 0x06, 0x00, 0x78, 0xb0, 0x0f, 0xf8, 0x01, 0x1f,
	0xe0, 0x01, 0x3c, 0x80, 0x0f, 0x18, 0xff, 0xc3, 0xff, 0xfc, 0xcf, 0xff,
	0xc0, 0x0f, 0xdf, 0xf1, 0xf1, 0x3f, 0xe0, 0x7f, 0xf0, 0xc1, 0xff, 0xf0,
	0x3f, 0xc0, 0xc1, 0x01, 0x00, 0x06, 0x00, 0xf0, 0x9f, 0x3f, 0xf8, 0xe0,
	0x7f, 0xfc, 0x8f, 0xff, 0x01, 0xfe, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x7e, 0xf0, 0x01, 0x00, 0x00, 0x00, 0xe0, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x3f, 0x00, 0x00, 0x06, 0x00, 0xe0, 0x07, 0x03, 0x70,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0x01, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x01, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0x01,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x7c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00 };
int width = 320;
int height = 180;

GLfloat frand(void) {
	return (GLfloat)rand() / (GLfloat)RAND_MAX;
}

int main(void) {
	SDL_Window *window;
	SDL_GLContext context;
	SDL_Event event;
	GLint majorVer;
	GLint minorVer;
	GLchar infoLog[2048];
	GLuint starVertexShader;
	GLuint starFragmentShader;
	GLuint starShaderProgram;
	GLint starTimeUniform;
	GLint starScaleUniform;
	GLint starSpeedUniform;
	GLint starPositionAttribute;
	GLint starCenterAttribute;
	GLint starProximityAttribute;
	GLfloat *starVertexData;
	size_t starCount = (size_t)(sqrt(width * height) * 4);
	GLuint starVertexArray;
	GLuint starVertexBuffer;
	GLuint witchVertexShader;
	GLuint witchFragmentShader;
	GLuint witchShaderProgram;
	GLint witchTimeUniform;
	GLint witchScaleUniform;
	GLint witchCenterUniform;
	GLint witchSizeUniform;
	GLint witchFieldUniform;
	GLint witchTextureUniform;
	GLint witchPositionAttribute;
	GLubyte witchPixelData[witchWidthAligned * witchHeight];
	GLuint witchTexture;
	GLuint witchVertexArray;
	GLuint witchVertexBuffer;
	GLuint textVertexShader;
	GLuint textFragmentShader;
	GLuint textShaderProgram;
	GLint textScaleUniform;
	GLint textCenterUniform;
	GLint textSizeUniform;
	GLint textTextureUniform;
	GLint textPositionAttribute;
	GLubyte textPixelData[textWidth * textHeight];
	GLuint textTexture;
	GLuint textVertexArray;
	GLuint textVertexBuffer;
	GLubyte* (*glGetIntegerv)(GLenum, GLint*);
	GLubyte* (*glGetString)(GLenum);
	void (*glEnable)(GLenum);
	void (*glBlendFunc)(GLenum, GLenum);
	GLuint (*glCreateShader)(GLenum);
	void (*glShaderSource)(GLuint, GLsizei, const GLchar**, const GLint*);
	void (*glCompileShader)(GLuint);
	void (*glGetShaderInfoLog)(GLuint, GLsizei, GLsizei*, GLchar*);
	GLuint (*glCreateProgram)(void);
	void (*glAttachShader)(GLuint, GLuint);
	void (*glLinkProgram)(GLuint);
	void (*glGetProgramInfoLog)(GLuint, GLsizei, GLsizei*, GLchar*);
	GLint (*glGetUniformLocation)(GLuint, const GLchar*);
	GLint (*glGetAttribLocation)(GLuint, const GLchar*);
	void (*glGenVertexArrays)(GLsizei n, GLuint*);
	void (*glBindVertexArray)(GLuint);
	void (*glGenBuffers)(GLsizei n, GLuint*);
	void (*glBindBuffer)(GLenum, GLuint);
	void (*glBufferData)(GLenum, GLsizeiptr, const GLvoid*, GLenum);
	void (*glEnableVertexAttribArray)(GLuint);
	void (*glVertexAttribPointer)(GLuint, GLint, GLenum, GLboolean, GLsizei, const GLvoid *);
	void (*glUseProgram)(GLuint);
	void (*glUniform1f)(GLint, GLfloat);
	void (*glUniform2f)(GLint, GLfloat, GLfloat);
	void (*glGenTextures)(GLsizei, GLuint*);
	void (*glBindTexture)(GLenum, GLuint);
	void (*glTexImage2D)(GLenum, GLint, GLint, GLsizei, GLsizei, GLint, GLenum, GLenum, const GLvoid*);
	void (*glTexParameteri)(GLenum, GLenum, GLint);
	void (*glActiveTexture)(GLenum);
	void (*glUniform1i)(GLint, GLint);
	void (*glClear)(GLbitfield mask);
	void (*glDrawArrays)(GLenum, GLint, GLsizei);

	srand(time(NULL));

	SDL_Init(SDL_INIT_VIDEO|SDL_INIT_EVENTS|SDL_INIT_TIMER);

	window = SDL_CreateWindow(
		"光の夢",
		SDL_WINDOWPOS_UNDEFINED,
		SDL_WINDOWPOS_UNDEFINED,
		320,
		180,
		SDL_WINDOW_OPENGL
	);
	if (window == NULL) {
		return -1;
	}

	SDL_GL_SetAttribute(SDL_GL_CONTEXT_PROFILE_MASK, SDL_GL_CONTEXT_PROFILE_CORE);
	SDL_GL_SetAttribute(SDL_GL_CONTEXT_FLAGS, SDL_GL_CONTEXT_FORWARD_COMPATIBLE_FLAG);
	SDL_GL_SetAttribute(SDL_GL_CONTEXT_MAJOR_VERSION, 3);
	SDL_GL_SetAttribute(SDL_GL_CONTEXT_MINOR_VERSION, 2);
	SDL_GL_SetAttribute(SDL_GL_MULTISAMPLEBUFFERS, 1);
	SDL_GL_SetAttribute(SDL_GL_MULTISAMPLESAMPLES, 4);
	SDL_GL_SetSwapInterval(1);

	context = SDL_GL_CreateContext(window);
	if (context == NULL) {
		return -1;
	}

	glGetIntegerv = SDL_GL_GetProcAddress("glGetIntegerv");
	glGetString = SDL_GL_GetProcAddress("glGetString");
	glEnable = SDL_GL_GetProcAddress("glEnable");
	glBlendFunc = SDL_GL_GetProcAddress("glBlendFunc");
	glCreateShader = SDL_GL_GetProcAddress("glCreateShader");
	glShaderSource = SDL_GL_GetProcAddress("glShaderSource");
	glCompileShader = SDL_GL_GetProcAddress("glCompileShader");
	glGetShaderInfoLog = SDL_GL_GetProcAddress("glGetShaderInfoLog");
	glCreateProgram = SDL_GL_GetProcAddress("glCreateProgram");
	glAttachShader = SDL_GL_GetProcAddress("glAttachShader");
	glLinkProgram = SDL_GL_GetProcAddress("glLinkProgram");
	glGetProgramInfoLog = SDL_GL_GetProcAddress("glGetProgramInfoLog");
	glGetAttribLocation = SDL_GL_GetProcAddress("glGetAttribLocation");
	glGetUniformLocation = SDL_GL_GetProcAddress("glGetUniformLocation");
	glGenVertexArrays = SDL_GL_GetProcAddress("glGenVertexArrays");
	glBindVertexArray = SDL_GL_GetProcAddress("glBindVertexArray");
	glGenBuffers = SDL_GL_GetProcAddress("glGenBuffers");
	glBindBuffer = SDL_GL_GetProcAddress("glBindBuffer");
	glBufferData = SDL_GL_GetProcAddress("glBufferData");
	glEnableVertexAttribArray = SDL_GL_GetProcAddress("glEnableVertexAttribArray");
	glVertexAttribPointer = SDL_GL_GetProcAddress("glVertexAttribPointer");
	glUseProgram = SDL_GL_GetProcAddress("glUseProgram");
	glUniform1f = SDL_GL_GetProcAddress("glUniform1f");
	glUniform2f = SDL_GL_GetProcAddress("glUniform2f");
	glGenTextures = SDL_GL_GetProcAddress("glGenTextures");
	glBindTexture = SDL_GL_GetProcAddress("glBindTexture");
	glTexImage2D = SDL_GL_GetProcAddress("glTexImage2D");
	glTexParameteri = SDL_GL_GetProcAddress("glTexParameteri");
	glActiveTexture = SDL_GL_GetProcAddress("glActiveTexture");
	glUniform1i = SDL_GL_GetProcAddress("glUniform1i");
	glClear = SDL_GL_GetProcAddress("glClear");
	glDrawArrays = SDL_GL_GetProcAddress("glDrawArrays");

	glGetIntegerv(GL_MAJOR_VERSION, &majorVer);
	glGetIntegerv(GL_MINOR_VERSION, &minorVer);
	fprintf(stderr, "OpenGL %d.%d (\"%s\")\n", majorVer, minorVer, (char*)glGetString(GL_VERSION));
	if (majorVer < 3 || (majorVer == 3 && minorVer < 2)) {
		fprintf(stderr, "OpenGL version too old\n");
		return -1;
	}

	glEnable(GL_BLEND);
	glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);

	starVertexShader = glCreateShader(GL_VERTEX_SHADER);
	glShaderSource(starVertexShader, 1, &starVertexShaderSource, NULL);
	glCompileShader(starVertexShader);
	glGetShaderInfoLog(starVertexShader, sizeof(infoLog), NULL, infoLog);
	fprintf(stderr, "star vertex shader compile log: %s\n", infoLog);

	starFragmentShader = glCreateShader(GL_FRAGMENT_SHADER);
	glShaderSource(starFragmentShader, 1, &starFragmentShaderSource, NULL);
	glCompileShader(starFragmentShader);
	glGetShaderInfoLog(starFragmentShader, sizeof(infoLog), NULL, infoLog);
	fprintf(stderr, "star fragment shader compile log: %s\n", infoLog);

	starShaderProgram = glCreateProgram();
	glAttachShader(starShaderProgram, starVertexShader);
	glAttachShader(starShaderProgram, starFragmentShader);
	glLinkProgram(starShaderProgram);
	glGetProgramInfoLog(starShaderProgram, sizeof(infoLog), NULL, infoLog);
	fprintf(stderr, "star shader program link log: %s\n", infoLog);

	starTimeUniform = glGetUniformLocation(starShaderProgram, "time");
	starScaleUniform = glGetUniformLocation(starShaderProgram, "scale");
	starSpeedUniform = glGetUniformLocation(starShaderProgram, "starSpeed");
	starPositionAttribute = glGetAttribLocation(starShaderProgram, "position");
	starCenterAttribute = glGetAttribLocation(starShaderProgram, "starCenter");
	starProximityAttribute = glGetAttribLocation(starShaderProgram, "starProximity");

	starVertexData = malloc(sizeof(GLfloat) * FLOATS_PER_STAR * starCount);
	for (size_t i = 0; i < starCount; i++) {
		GLfloat x = frand() * 2 - 1;
		GLfloat y = frand() * 2 - 1;
		GLfloat proximity = pow(frand(), 4);
		for (size_t j = 0; j < sizeof(squarePoints)/sizeof(squarePoints[0]); j += 2) {
			GLfloat vertex[] = {
				squarePoints[j],
				squarePoints[j + 1],
				x,
				y,
				proximity
			};
			memcpy(&starVertexData[i * FLOATS_PER_STAR + j * FLOATS_PER_STAR_VERTEX / 2], vertex, sizeof(vertex));
		}
	}

	glUseProgram(starShaderProgram);

	glUniform2f(starScaleUniform, 1.0 / width, 1.0 / height);
	glUniform1f(starSpeedUniform, (1440.0 / width) / 8);

	glGenVertexArrays(1, &starVertexArray);
	glBindVertexArray(starVertexArray);

	glGenBuffers(1, &starVertexBuffer);
	glBindBuffer(GL_ARRAY_BUFFER, starVertexBuffer);
	glBufferData(GL_ARRAY_BUFFER, sizeof(GLfloat) * FLOATS_PER_STAR * starCount, starVertexData, GL_STATIC_DRAW);

	glEnableVertexAttribArray(starPositionAttribute);
	glVertexAttribPointer(starPositionAttribute, 2, GL_FLOAT, GL_FALSE, 5 * 4, (const GLvoid*)0);
	glEnableVertexAttribArray(starCenterAttribute);
	glVertexAttribPointer(starCenterAttribute, 2, GL_FLOAT, GL_FALSE, 5 * 4, (const GLvoid*)(2 * 4));
	glEnableVertexAttribArray(starProximityAttribute);
	glVertexAttribPointer(starProximityAttribute, 1, GL_FLOAT, GL_FALSE, 5 * 4, (const GLvoid*)(4 * 4));

	witchVertexShader = glCreateShader(GL_VERTEX_SHADER);
	glShaderSource(witchVertexShader, 1, &witchVertexShaderSource, NULL);
	glCompileShader(witchVertexShader);
	glGetShaderInfoLog(witchVertexShader, sizeof(infoLog), NULL, infoLog);
	fprintf(stderr, "witch vertex shader compile log: %s\n", infoLog);

	witchFragmentShader = glCreateShader(GL_FRAGMENT_SHADER);
	glShaderSource(witchFragmentShader, 1, &witchFragmentShaderSource, NULL);
	glCompileShader(witchFragmentShader);
	glGetShaderInfoLog(witchFragmentShader, sizeof(infoLog), NULL, infoLog);
	fprintf(stderr, "witch fragment shader compile log: %s\n", infoLog);

	witchShaderProgram = glCreateProgram();
	glAttachShader(witchShaderProgram, witchVertexShader);
	glAttachShader(witchShaderProgram, witchFragmentShader);
	glLinkProgram(witchShaderProgram);
	glGetProgramInfoLog(witchShaderProgram, sizeof(infoLog), NULL, infoLog);
	fprintf(stderr, "witch shader program link log: %s\n", infoLog);

	witchTimeUniform = glGetUniformLocation(witchShaderProgram, "time");
	witchScaleUniform = glGetUniformLocation(witchShaderProgram, "scale");
	witchCenterUniform = glGetUniformLocation(witchShaderProgram, "witchCenter");
	witchSizeUniform = glGetUniformLocation(witchShaderProgram, "witchSize");
	witchFieldUniform = glGetUniformLocation(witchShaderProgram, "witchField");
	witchTextureUniform = glGetUniformLocation(witchShaderProgram, "witchTexture");
	witchPositionAttribute = glGetAttribLocation(witchShaderProgram, "position");

	for (i = 0; i < witchWidth * witchHeight; i++) {
		char bit = 1 & (witchPixels[i >> 3] >> (7 - (i & 7)));
		size_t index = (i / witchWidth) * witchWidthAligned + i % witchWidth;
		witchPixelData[index] = (1 - bit) * 0xFF;
	}

	glGenTextures(1, &witchTexture);
	glBindTexture(GL_TEXTURE_2D, witchTexture);
	glTexImage2D(GL_TEXTURE_2D, 0, GL_RED, witchWidth, witchHeight, 0, GL_RED, GL_UNSIGNED_BYTE, witchPixelData);
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST);
	// non-power-of-two texture dimensions
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);

	glUseProgram(witchShaderProgram);

	glGenVertexArrays(1, &witchVertexArray);
	glBindVertexArray(witchVertexArray);

	glGenBuffers(1, &witchVertexBuffer);
	glBindBuffer(GL_ARRAY_BUFFER, witchVertexBuffer);
	glBufferData(GL_ARRAY_BUFFER, sizeof(squarePoints), squarePoints, GL_STATIC_DRAW);

	glEnableVertexAttribArray(witchPositionAttribute);
	glVertexAttribPointer(witchPositionAttribute, 2, GL_FLOAT, GL_FALSE, 2 * 4, (const GLvoid*)0);

	glUniform2f(witchSizeUniform, witchWidth, witchHeight);
	glUniform2f(witchFieldUniform, 0, height / 1.5);
	glUniform2f(witchCenterUniform, -width / 1.375, 0); 
	glUniform2f(witchScaleUniform, 1.0 / width, 1.0 / height);
	glUniform1i(witchTextureUniform, 0);

	textVertexShader = glCreateShader(GL_VERTEX_SHADER);
	glShaderSource(textVertexShader, 1, &textVertexShaderSource, NULL);
	glCompileShader(textVertexShader);
	glGetShaderInfoLog(textVertexShader, sizeof(infoLog), NULL, infoLog);
	fprintf(stderr, "text vertex shader compile log: %s\n", infoLog);

	textFragmentShader = glCreateShader(GL_FRAGMENT_SHADER);
	glShaderSource(textFragmentShader, 1, &textFragmentShaderSource, NULL);
	glCompileShader(textFragmentShader);
	glGetShaderInfoLog(textFragmentShader, sizeof(infoLog), NULL, infoLog);
	fprintf(stderr, "text fragment shader compile log: %s\n", infoLog);

	textShaderProgram = glCreateProgram();
	glAttachShader(textShaderProgram, textVertexShader);
	glAttachShader(textShaderProgram, textFragmentShader);
	glLinkProgram(textShaderProgram);
	glGetProgramInfoLog(textShaderProgram, sizeof(infoLog), NULL, infoLog);
	fprintf(stderr, "text shader program link log: %s\n", infoLog);

	textScaleUniform = glGetUniformLocation(textShaderProgram, "scale");
	textCenterUniform = glGetUniformLocation(textShaderProgram, "center");
	textSizeUniform = glGetUniformLocation(textShaderProgram, "size");
	textTextureUniform = glGetUniformLocation(textShaderProgram, "textTexture");
	textPositionAttribute = glGetAttribLocation(textShaderProgram, "position");

	for (i = 0; i < textWidth * textHeight; i++) {
		char bit = 1 & (textBits[i >> 3] >> (i & 7));
		textPixelData[i] = bit * 0xFF;
	}

	glGenTextures(1, &textTexture);
	glBindTexture(GL_TEXTURE_2D, textTexture);
	glTexImage2D(GL_TEXTURE_2D, 0, GL_RED, textWidth, textHeight, 0, GL_RED, GL_UNSIGNED_BYTE, textPixelData);
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
	// non-power-of-two texture dimensions
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
	glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);

	glUseProgram(textShaderProgram);

	glGenVertexArrays(1, &textVertexArray);
	glBindVertexArray(textVertexArray);

	glGenBuffers(1, &textVertexBuffer);
	glBindBuffer(GL_ARRAY_BUFFER, textVertexBuffer);
	glBufferData(GL_ARRAY_BUFFER, sizeof(squarePoints), squarePoints, GL_STATIC_DRAW);

	glEnableVertexAttribArray(textPositionAttribute);
	glVertexAttribPointer(textPositionAttribute, 2, GL_FLOAT, GL_FALSE, 2 * 4, (const GLvoid*)0);

	glUniform2f(textSizeUniform, textWidth / 1.5, textHeight / 1.5);
	glUniform2f(textCenterUniform, textWidth / 4.5, 0); 
	glUniform2f(textScaleUniform, 1.0 / width, 1.0 / height);

	glBindTexture(GL_TEXTURE_2D, textTexture);
	glUniform1i(textTextureUniform, 0);

	while (1) {
		Uint32 newTime = SDL_GetTicks();

		glClear(GL_COLOR_BUFFER_BIT);

		glUseProgram(starShaderProgram);
		glBindVertexArray(starVertexArray);
		glUniform1f(starTimeUniform, newTime / 1000.0);
		glDrawArrays(GL_TRIANGLES, 0, starCount * 2);

		glUseProgram(witchShaderProgram);
		glBindVertexArray(witchVertexArray);
		glBindTexture(GL_TEXTURE_2D, witchTexture);
		glUniform1f(witchTimeUniform, newTime / 1000.0);
		glDrawArrays(GL_TRIANGLES, 0, 6);

		glUseProgram(textShaderProgram);
		glBindVertexArray(textVertexArray);
		glBindTexture(GL_TEXTURE_2D, textTexture);
		glDrawArrays(GL_TRIANGLES, 0, 6);

		SDL_GL_SwapWindow(window);

		while (SDL_PollEvent(&event)) {
			if (event.type == SDL_QUIT) {
				return 0;
			}
		}
	}
}
